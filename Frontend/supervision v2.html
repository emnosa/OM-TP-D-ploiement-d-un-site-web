<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supervision et Configuration</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header class="bg-primary text-white text-center py-4">
    <h1>Application de Supervision</h1>
    <p>Configuration et supervision des données en temps réel</p>
  </header>

  <div class="container my-5">
    <!-- Formulaire de configuration -->
    <div class="section">
      <h2>Configuration des paramètres</h2>
      <form id="configForm">
        <div class="mb-3">
          <label for="variableName" class="form-label">Nom de la variable</label>
          <input type="text" class="form-control" id="variableName" placeholder="Exemple : Température">
        </div>
        <div class="mb-3">
          <label for="ipAddress" class="form-label">Adresse IP de l'automate</label>
          <input type="text" class="form-control" id="ipAddress" placeholder="Exemple : 192.168.0.10">
        </div>
        <div class="mb-3">
          <label for="variableToRead" class="form-label">Variable à lire</label>
          <input type="text" class="form-control" id="variableToRead" placeholder="Exemple : sensor_1">
        </div>
        <div class="mb-3">
          <label for="frequency" class="form-label">Fréquence de mise à jour (en secondes)</label>
          <input type="number" class="form-control" id="frequency" placeholder="Exemple : 5">
        </div>
        <button type="button" class="btn btn-primary" onclick="saveConfiguration()">Sauvegarder et démarrer</button>
      </form>
    </div>

    <!-- Historique des configurations -->
    <div class="section mt-5">
      <h2>Historique des configurations</h2>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>#</th>
            <th>Nom de la variable</th>
            <th>Adresse IP</th>
            <th>Variable à lire</th>
            <th>Fréquence (s)</th>
          </tr>
        </thead>
        <tbody id="configHistory">
          <!-- Les configurations sauvegardées seront affichées ici -->
        </tbody>
      </table>
    </div>

    <!-- Graphique en temps réel -->
    <div class="section mt-5">
      <h2>Supervision en temps réel</h2>
      <canvas id="realtimeChart" width="400" height="200"></canvas>
    </div>
  </div>

  <script>
    let counter = 1; // Compteur pour l'historique
    let chart; // Graphique
    let intervalId; // ID de l'intervalle pour les mises à jour

    const simulatedData = []; // Stocke les valeurs simulées
    const simulatedLabels = []; // Stocke les timestamps des données

// Initialisation du graphique
function initializeChart() {
  const ctx = document.getElementById('realtimeChart').getContext('2d');
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: simulatedLabels, // X-axis (les timestamps)
      datasets: [{
        label: 'Valeurs simulées',
        data: simulatedData, // Y-axis (les valeurs simulées)
        borderColor: 'rgba(75, 192, 192, 1)',  // Couleur de la ligne
        backgroundColor: 'rgba(75, 192, 192, 0.2)', // Remplissage sous la ligne (si nécessaire)
        borderWidth: 2,  // Épaisseur de la ligne
        tension: 0,  // Pas de courbure
        fill: false,  // Pas de remplissage sous la ligne
        stepped: true  // Effet "marche" ou "muret" pour relier les points
      }]
    },
    options: {
      scales: {
        x: { title: { display: true, text: 'Temps' } },
        y: {
          title: { display: true, text: 'Valeurs' },
          min: -0.2,  // Affiche légèrement en dessous de 0
          max: 1.2,   // Affiche légèrement au-dessus de 1
          ticks: { stepSize: 0.2 }
        }
      }
    }
  });
}


    // Fonction pour sauvegarder la configuration
    function saveConfiguration() {
      // Récupérer les valeurs du formulaire
      const variableName = document.getElementById('variableName').value;
      const ipAddress = document.getElementById('ipAddress').value;
      const variableToRead = document.getElementById('variableToRead').value;
      const frequency = parseInt(document.getElementById('frequency').value);

      // Vérifier que les champs sont valides
      if (!variableName || !ipAddress || !variableToRead || isNaN(frequency) || frequency <= 0) {
        alert("Veuillez remplir tous les champs correctement !");
        return;
      }

      // Ajouter dans l'historique
      const tableBody = document.getElementById('configHistory');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${counter++}</td>
        <td>${variableName}</td>
        <td>${ipAddress}</td>
        <td>${variableToRead}</td>
        <td>${frequency}</td>
      `;
      tableBody.appendChild(row);

      // Démarrer la simulation de données
      if (intervalId) clearInterval(intervalId); // Réinitialiser si déjà en cours
      startSimulation(frequency);
      document.getElementById('configForm').reset();
    }

    // Fonction pour simuler des données et mettre à jour le graphique
    function startSimulation(frequency) {
      intervalId = setInterval(() => {
        const now = new Date().toLocaleTimeString();
        const randomValue = Math.floor(Math.random() * 2); // Résultat : 0 ou 1
; // Génère une valeur entre 0 et 1

        // Ajouter les nouvelles données
        simulatedLabels.push(now);
        simulatedData.push(randomValue);

        // Supprimer les données les plus anciennes si nécessaire
        if (simulatedLabels.length > 10) {
          simulatedLabels.shift();
          simulatedData.shift();
        }

        // Mettre à jour le graphique
        chart.update();
      }, frequency * 1000); // Intervalle en fonction de la fréquence
    }

    // Initialiser le graphique au chargement de la page
    initializeChart();
  </script>
</body>
</html>
